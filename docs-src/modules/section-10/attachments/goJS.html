<!DOCTYPE html>
<html>
<head>
  <title>GoJS Экспорт в PNG</title>
  <script src="https://unpkg.com/gojs/release/go.js"></script>
  <style>
    #myDiagramDiv {
      width: 500px;
      height: 300px;
      border: 1px solid #ccc;
    }
    #exportBtn {
      margin: 10px;
      padding: 8px 16px;
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Контейнер для диаграммы -->
  <div id="myDiagramDiv"></div>
  
  <!-- Кнопка для экспорта -->
  <button id="exportBtn">Сохранить как PNG</button>

  <script>
    const $ = go.GraphObject.make;

    // Создаём диаграмму
    const myDiagram = $(
      go.Diagram,
      "myDiagramDiv",
      {
        "undoManager.isEnabled": true
      }
    );

    // Шаблон узла
    myDiagram.nodeTemplate = $(
      go.Node,
      "Auto",
      $(go.Shape, "Circle", { fill: "lightblue" }),
      $(go.TextBlock, { margin: 5 }, new go.Binding("text", "key"))
    );

    // Данные модели (простое дерево)
    myDiagram.model = new go.GraphLinksModel(
      [
        { key: "Root" },
        { key: "Child 1" },
        { key: "Child 2" }
      ],
      [
        { from: "Root", to: "Child 1" },
        { from: "Root", to: "Child 2" }
      ]
    );

    // Обработчик кнопки "Сохранить как PNG"
    document.getElementById("exportBtn").addEventListener("click", () => {
      const imageData = myDiagram.makeImageData({
        scale: 1,
        background: "white",
        type: "image/png"  // Можно изменить на "image/svg+xml" для SVG
      });

      // Создаём ссылку для скачивания
      const link = document.createElement("a");
      link.href = imageData;
      link.download = "diagram.png";  // Имя файла
      link.click();
    });
  </script>
</body>
</html>